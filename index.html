<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Service Guarantee Chatbot</title>
<style>
  body {
    font-family: Dengxian, Arial, sans-serif;
    margin: 0;
    display: flex;
    height: 100vh;
    background: #f5f7fa;
  }

  .instructions {
    flex: 1;
    padding: 20px;
    background: #fff;
    overflow-y: auto;
  }

  .instructions h2 {
    margin-top: 0;
  }

  .bot-capabilities {
    background: #e0f0ff;
    border: 1px solid #99ccff;
    padding: 10px;
    margin-bottom: 15px;
  }

  .chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: #e9eff5;
    border-right: 2px solid #ccc; /* Chat on left */
    padding: 10px;
  }

  .chat-box {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
  }

  .chat-input {
    display: flex;
    padding: 10px;
    background: #fff;
    border-top: 1px solid #ccc;
  }

  .chat-input input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-family: Dengxian, Arial, sans-serif;
  }

  .bubble {
    max-width: 70%;
    padding: 10px;
    margin: 10px 0;
    border-radius: 15px;
    line-height: 1.6;
    word-break: break-word;
    font-family: Dengxian, Arial, sans-serif;
  }

  .bot {
    background: #007bff;
    color: white;
    align-self: flex-start;
  }

  .user {
    background: #ddd;
    align-self: flex-end;
  }

  .button-bubble {
    display: inline-block;
    margin: 5px 5px 0 0;
    padding: 8px 12px;
    background: #00aaff;
    color: white;
    border-radius: 12px;
    cursor: pointer;
    font-family: Dengxian, Arial, sans-serif;
  }

  .script-block {
    background: #fff3cd;
    border-left: 4px solid #ffeeba;
    padding: 10px;
    margin: 10px 0;
    white-space: pre-wrap;
  }

</style>
</head>
<body>
<div class="instructions">
  <h2>Welcome to Service Guarantee Chatbot</h2>
  <div class="bot-capabilities">
    <strong>What I can do:</strong>
    <ul>
      <li>Judge Flight-Hotel Guarantee eligibility</li>
      <li>Guide Special Circumstance cancellation workflow</li>
      <li>Remind agents about missing or insufficient proofs</li>
      <li>Insert QA-approved scripts for communication</li>
      <li>Provide Knowledge Hub links</li>
    </ul>
  </div>
  <p><strong>Note:</strong> Type 'cancel' to start a Service Guarantee workflow. Use buttons or type numbers for selections.</p>
</div>

<div class="chat-container">
  <div id="chat-box" class="chat-box"></div>
  <div class="chat-input">
    <input id="user-input" type="text" placeholder="Type your message..." />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
const chatBox = document.getElementById("chat-box");
const userInput = document.getElementById("user-input");

let currentStep = null;
let currentScenario = null;

// Flight-Hotel Guarantee logic: Check if hotel check-in is affected
function isFhEligible(flightArrival, hotelCheckIn) {
  return flightArrival >= hotelCheckIn;
}

const medicalProofs = {
  emergency: ["Official Diagnostics","Medical Leave Certificate","Proof of Medical Charge"],
  "not suitable for travel": ["Official Diagnostics","Medical Leave Certificate","Proof of Medical Charge"],
  "be hospitalized": ["Official Diagnostics","Hospitalization Certificate","Proof of Medical Charge"],
  fracture: ["Official Diagnostics","Medical Leave Certificate","Proof of Medical Charge"],
  pregnancy: ["Official Diagnostics","Medical Leave Certificate","Proof of Medical Charge"],
  "mental health": null,
  death: null
};

const scripts = {
  1: `Greetings from Trip.com!\n\nI'm so sorry to hear that you/your xxx is not able to travel due to xx(covid,surgery...), we understand that this is something that out of your control, and we'd definitely love to help you to reduce your loss as much as possible.\n\nUnfortunately, as we negotiated with our hotel partner Ms/Mr xx, we're unable to secure an agreement of the free cancellation with hotel.\n\nNow we'd like to seek another option which would be helpful for the free cancellatin process. We sincerely appreciate if you could provide us with the following medical documentations:\n\n1. Official Diagnostics  ï¼ˆWell Receivedï¼‰\n2. Medical Leave Certificate ï¼ˆNeed to be collected before deadlineï¼‰\n3. Proof of Medical Chargeï¼ˆNeed to be collected before deadlineï¼‰(According to the actual situationï¼‰\n\nWe understand it may take time to get these proof from the hospital/clinic, please kindly provide us before the ddl xxx\n\nThus we can review all the documents to check if it's possible to help you to save your loss of this reservation.\n\nWe understand that due to health coverage, medical insurance of some countries,you may not have those ,please kindly feel free to let us know. We'll still try our best to assist you.\n\nThank you so much for your support !`,
  2: `Dear [Guest's Name],\n\nWe hope this message finds you well. We were truly saddened to learn about your medical situation, and we want to extend our heartfelt sympathy and support during this challenging time.\n\nRegarding your booking, we have made every effort to liaise with the hotel and have communicated your circumstances to them. \n\nUnfortunately, due to the original non-refundable and non-changeable policy, the hotel staff, [Staff Member's Name], was unable to authorize a free modification or cancellation. We sincerely apologize for any inconvenience this may cause, as we are bound by the hotel's policies and cannot make changes without their consent.\n\nHowever, there is still a possibility for us to assist you with a free cancellation request. We recommend obtaining assistance from the hospital to provide the necessary documentation, which includes:\n\n1.Official Diagnostic Report (already received)\n2.Medical Leave Certificate (already received)\n3.Proof of Payment to the Hospital (still needed, you may provide it by Ã—Ã—Ã— .*please inform us if it was covered by insurance)\n\nOnce you have these documents, please forward them to us, and we will promptly consult with our relevant team to pursue the cancellation request on your behalf.\n\nWe apologize once again for any inconvenience and appreciate your understanding. Please take care of yourself, and do not hesitate to reach out if you have any further questions or need additional assistance.`,
  3: `I am very sorry to inform you that I have tried my best to coordinate with the supplier and explained your situation to hotel staff, but they couldn't agree to modify or cancel this booking for free because the original policy of the booking is non-refundable and non-changeable.\n\nAs the hotel policy is strict, if without their permission, I am afraid that I couldn't directly modify or cancel it for you. Please accept our sincere apologies, we know this may not be the preferred outcome, however, it is out of our control, and we are obligated to abide by the hotel-imposed penalties.\n\nWe understand that you need to cancel the booking due to health issues, please know that we are concerned about your well-being and wish you a speedy recovery. Trip.com is willing to assist you. Please provide the following supporting documents for our team to review before XXXï¼ˆDeadlineï¼‰:\n\n1. Official Diagnostics  ï¼ˆNot Receivedï¼‰\n2. Medical Leave Certificate ï¼ˆNot Receivedï¼‰\n3. Proof of Medical Chargeï¼ˆNot Receivedï¼‰\nï¼ˆPlease remove "Not" if the ecidence is receivedï¼‰\n\nIf you encounter difficulties in providing Proof of Medical Charge due to health coverage, medical insurance, or other reasons, we would appreciate it if you could kindly inform us of any special circumstances.\n\nThank you for your understanding and cooperation. If you have any questions, please feel free to contact us.`,
  4: `Dear [Guest's Name],\n\nI am very sorry to inform you that I have tried my best to coordinate with the supplier and explained your situation to the  hotel staff. Still, they couldn't agree to modify or cancel this booking for free because the original policy of the booking is non-refundable and non-changeable. \n\nWe are really sorry to hear about what happened ( state what specifically happened ). I hope she/he recovers quickly. I see that youâ€™ve already shared a medical certificate and proof of charges. Thank you for providing those. However, we might ask for additional documents to support your cancellation request. \n\nâ€¢ Doctorâ€™s note confirming that your wife/husband/child/parents etc, is unfit to travel. \n\nâ€¢ Proof of relationship (such as a marriage certificate/birth certificate) to confirm your relationship to the traveler\n\nThese documents are necessary for us to validate the request and ensure we can further assist you.`
};

function addMessage(text, sender="bot", typing=false){
  if(typing){
    const bubble = document.createElement("div");
    bubble.className = `bubble ${sender}`;
    chatBox.appendChild(bubble);
    let i = 0;
    const interval = setInterval(()=>{
      bubble.textContent += text.charAt(i);
      i++;
      if(i>=text.length) clearInterval(interval);
      chatBox.scrollTop = chatBox.scrollHeight;
    },10);
  } else {
    const bubble = document.createElement("div");
    bubble.className = `bubble ${sender}`;
    bubble.textContent = text;
    chatBox.appendChild(bubble);
    chatBox.scrollTop = chatBox.scrollHeight;
  }
}

function sendMessage(){
  const text = userInput.value.trim();
  if(!text) return;
  addMessage(text, "user");
  userInput.value = "";
  processMessage(text);
}

function showButtons(options){
  const bubble = document.createElement("div");
  bubble.className = "bubble bot";
  options.forEach((opt,i)=>{
    const btn = document.createElement("div");
    btn.className = "button-bubble";
    btn.textContent = opt;
    btn.onclick = ()=>{addMessage(opt,"user"); handleOption(i+1);}
    bubble.appendChild(btn);
  });
  chatBox.appendChild(bubble);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function insertScript(num){
  if(scripts[num]){
    addMessage(`Script selected â†’\n\n${scripts[num]}`,"bot",true);
  }
}

// Example handler
function handleOption(opt){
  if(currentStep==="selectScenario"){
    currentScenario = opt;
    if(opt===1) addMessage("Flight-Hotel Guarantee selected. Please enter flight arrival date and hotel check-in date in format YYYY-MM-DD to YYYY-MM-DD","bot");
    if(opt===2) addMessage("Special Circumstance selected. Choose: 1ï¸âƒ£ Guest is patient, 2ï¸âƒ£ Guest is relative","bot",true);
    currentStep = "processScenario";
  } else if(currentStep==="scriptSelection"){
    insertScript(opt);
  }
}

function processMessage(msg){
  msg = msg.toLowerCase();
  if(msg==="cancel"){
    currentStep="selectScenario";
    addMessage("ðŸ‘‹ Welcome! Type 'Cancel' to begin a Service Guarantee workflow.","bot");
    showButtons(["Flight-Hotel Guarantee","Special Circumstance"]);
    return;
  }

  if(currentStep==="processScenario"){
    if(currentScenario===1){
      const parts = msg.split("to").map(d=>new Date(d.trim()));
      if(parts.length===2){
        const eligible = isFhEligible(parts[0],parts[1]);
        addMessage(eligible?"Flight-Hotel Guarantee eligible based on dates":"Flight-Hotel Guarantee not applicable (hotel check-in not affected)","bot");
        currentStep="scriptSelection";
        showButtons(["Script 1","Script 2","Script 3","Script 4"]);
      }
    } else if(currentScenario===2){
      addMessage("Processing Special Circumstance... Check provided proofs and suggest next action.","bot",true);
      currentStep="scriptSelection";
      showButtons(["Script 1","Script 2","Script 3","Script 4"]);
    }
  }
}

addMessage("ðŸ‘‹ Welcome! Type 'Cancel' to begin a Service Guarantee workflow.","bot");

</script>
</body>
</html>