<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Service Guarantee Chatbot</title>
<style>
body { font-family: Dengxian, Arial, sans-serif; margin:0; display:flex; height:100vh; background:#f5f7fa;}
.chat-container{flex:3;display:flex;flex-direction:column;background:#e9eff5;padding:10px;border-right:2px solid #ccc;}
.side-panel{flex:1; background:#fff;padding:10px;overflow-y:auto; border-left:2px solid #ccc;}
.chat-box{flex:1;padding:10px;overflow-y:auto;}
.chat-input{display:flex;padding:10px;background:#fff;border-top:1px solid #ccc;}
.chat-input input{flex:1;padding:10px;border:1px solid #ccc;border-radius:5px;font-family:Dengxian, Arial, sans-serif;}
.bubble{max-width:70%;padding:10px;margin:10px 0;border-radius:15px;line-height:1.6;word-break:break-word;font-family:Dengxian, Arial, sans-serif;white-space:pre-wrap;}
.bot{background:#007bff;color:white;align-self:flex-start;}
.user{background:#ddd;align-self:flex-end;}
.button-bubble{display:inline-block;margin:5px 5px 0 0;padding:8px 12px;background:#00aaff;color:white;border-radius:12px;cursor:pointer;font-family:Dengxian, Arial, sans-serif;}
.checkbox-container{margin:5px 0;}
.checkbox-container input{margin-right:5px;}
.script-block{background:#fff3cd;border-left:4px solid #ffeeba;padding:10px;margin:10px 0;white-space:pre-wrap;}
</style>
</head>
<body>

<div class="chat-container">
  <div id="chat-box" class="chat-box"></div>
  <div class="chat-input">
    <input id="user-input" type="text" placeholder="Type your message..." />
    <button onclick="sendMessage()">Send</button>
    <button onclick="restartChat()">Restart</button>
  </div>
</div>

<div class="side-panel">
  <h2>Service Guarantee Instructions</h2>
  <div class="bot-capabilities">
    <strong>Bot Capabilities:</strong>
    <ul>
      <li>Judge Flight-Hotel Guarantee eligibility</li>
      <li>Guide Special Circumstance cancellation workflow</li>
      <li>Remind agents about missing proofs</li>
      <li>Provide QC/KA-approved script templates</li>
      <li>Provide Knowledge Hub links</li>
    </ul>
  </div>
  <div class="kh-links">
    <strong>KH Links:</strong>
    <ul>
      <li>
        Flight-Hotel Cancellation Guarantee: 
        <a href="http://knowledgehub.basebiz.ctripcorp.com/webapp/sp/servicebible/knowledgesync/selectNew?currentBusinessTypeId=26&businessId=6938&subjectId=67740&sceneId=2523886%2C2523914%2C2523942&locale=en-US" target="_blank">View KH</a>
      </li>
      <li>
        Special Circumstance Cancellation Service Guarantee: 
        <a href="http://knowledgehub.basebiz.ctripcorp.com/webapp/sp/servicebible/knowledgesync/selectNew?currentBusinessTypeId=26&businessId=6938&subjectId=67740&sceneId=2523886%2C2523914%2C2523977&locale=en-US" target="_blank">View KH</a>
      </li>
    </ul>
    <br>
    <strong>Accepted proofs:</strong>
    <ul>
      <li>Official diagnostics</li>
      <li>Medical leave certificate</li>
      <li>Proof of medical charge</li>
      <li>Proof of relationship</li>
    </ul>
  </div>
</div>

<script>
const chatBox = document.getElementById("chat-box");
const userInput = document.getElementById("user-input");

let providedProofs = [];
let currentScenario = null;
let specialEvent = null;

// Scripts
const scripts = {
  "Official diagnostics": `Greetings from Trip.com!\n\nI'm so sorry to hear that you/your xxx is not able to travel due to xx(covid,surgery...), we understand that this is something that out of your control, and we'd definitely love to help you reduce your loss.\n\nUnfortunately, as we negotiated with our hotel partner Ms/Mr xx, we're unable to secure an agreement of the free cancellation with hotel.\n\nNow we'd like to seek another option which would be helpful for the free cancellation process. We sincerely appreciate if you could provide us with the following medical documentations:\n\n1. Official Diagnostics / Medical Record ï¼ˆWell Receivedï¼‰\n2. Medical Leave Certificate ï¼ˆNeed to be collected before deadlineï¼‰\n3. Proof of Medical Chargeï¼ˆNeed to be collected before deadlineï¼‰\n\nThank you for your support!`,
  "Medical leave certificate": `Greetings from Trip.com!\n\nI'm so sorry to hear that you/your xxx is not able to travel due to xx(covid,surgery...), we understand that this is something that out of your control, and we'd definitely love to help you reduce your loss.\n\nUnfortunately, as we negotiated with our hotel partner Ms/Mr xx, we're unable to secure an agreement of the free cancellation with hotel.\n\nNow we'd like to seek another option which would be helpful for the free cancellation process. We sincerely appreciate if you could provide us with the following medical documentations:\n\n1. Official Diagnostics / Medical Record â€“ Need to be collected\n2. Medical Leave Certificate ï¼ˆWell Receivedï¼‰\n3. Proof of Medical Chargeï¼ˆNeed to be collected before deadlineï¼‰\n\nThank you for your support!`,
  "No proof": `I am very sorry to inform you that I have tried my best to coordinate with the supplier and explained your situation to hotel staff, but they couldn't agree to modify or cancel this booking for free because the original policy of the booking is non-refundable and non-changeable.\n\nPlease provide the following supporting documents for our team to review before XXXï¼ˆDeadlineï¼‰:\n1. Official Diagnostics  ï¼ˆNot Receivedï¼‰\n2. Medical Leave Certificate ï¼ˆNot Receivedï¼‰\n3. Proof of Medical Charge ï¼ˆNot Receivedï¼‰\n\nIf you encounter difficulties in providing Proof of Medical Charge due to health coverage, medical insurance, or other reasons, please inform us of any special circumstances.\n\nThank you for your understanding.`,
  "Guest is not the patient": `Dear [Guest's Name],\n\nI am very sorry to inform you that I have tried my best to coordinate with the supplier and explained your situation to the hotel staff. Still, they couldn't agree to modify or cancel this booking for free because the original policy is non-refundable and non-changeable.\n\nWe are really sorry to hear about what happened (state what specifically happened). I see that youâ€™ve already shared a medical certificate and proof of charges. However, we might ask for additional documents:\nâ€¢ Doctorâ€™s note confirming that your wife/husband/child/parents etc, is unfit to travel.\nâ€¢ Proof of relationship (marriage certificate/birth certificate).\n\nThese are necessary to validate the request and assist further.`
};

// Add message
function addMessage(text,sender="bot"){
  const bubble=document.createElement("div");
  bubble.className=`bubble ${sender}`;
  bubble.textContent=text;
  chatBox.appendChild(bubble);
  chatBox.scrollTop=chatBox.scrollHeight;
}

// Show clickable buttons
function showButtons(options,callback){
  const bubble=document.createElement("div");
  bubble.className="bubble bot";
  options.forEach(opt=>{
    const btn=document.createElement("div");
    btn.className="button-bubble";
    btn.textContent=opt;
    btn.onclick=()=>{ addMessage(opt,"user"); callback(opt); }
    bubble.appendChild(btn);
  });
  chatBox.appendChild(bubble);
  chatBox.scrollTop=chatBox.scrollHeight;
}

// Parse proof selection and show correct script
function parseProofSelection(){
  if(providedProofs.length===0) addMessage(scripts["No proof"]);
  else if(providedProofs.includes("Official diagnostics") && providedProofs.length===1) addMessage(scripts["Official diagnostics"]);
  else if(providedProofs.includes("Medical leave certificate") && providedProofs.length===1) addMessage(scripts["Medical leave certificate"]);
  else if(providedProofs.includes("Guest is not the patient")) addMessage(scripts["Guest is not the patient"]);
  else addMessage("Multiple proofs selected. Custom script can be reviewed.");
}

// Restart chat
function restartChat(){
  chatBox.innerHTML="";
  providedProofs=[];
  currentScenario=null;
  specialEvent=null;
  addMessage("ðŸ‘‹ Chat restarted. Please select your scenario:");
  showButtons(["Flight-Hotel Guarantee","Special Circumstance"],handleScenario);
}

// Handle scenario selection
function handleScenario(option){
  if(option==="Flight-Hotel Guarantee") addFhForm();
  if(option==="Special Circumstance") startSpecialCircumstance();
}

// Enable Enter key
userInput.addEventListener("keypress",function(e){ if(e.key==="Enter"){ sendMessage(); } });

function sendMessage(){
  const text=userInput.value.trim();
  if(!text) return;
  addMessage(text,"user");
  userInput.value="";
}

// Flight-Hotel Guarantee workflow
function addFhForm(){
  addMessage("Was the guest's flight booked with Trip.com?");
  showButtons(["Yes","No"],resp=>{
    if(resp==="Yes"){
      addMessage("Is the notice time of flight involuntary change made after the guest made the booking?");
      showButtons(["Yes","No"],resp2=>{
        if(resp2==="Yes"){
          addMessage("Has the hotel check-in date passed?");
          showButtons(["Yes","No"],resp3=>{
            if(resp3==="No"){
              const formDiv=document.createElement("div");
              formDiv.className="form-input";
              formDiv.innerHTML=`
                <label>Affected flight date:</label>
                <input id="fh-flight" type="date" />
                <label>Hotel check-in date:</label>
                <input id="fh-checkin" type="date" />
                <button id="fh-submit">Submit</button>
              `;
              chatBox.appendChild(formDiv);
              chatBox.scrollTop=chatBox.scrollHeight;
              document.getElementById("fh-submit").onclick=()=>{
                const flightDate=new Date(document.getElementById("fh-flight").value);
                const hotelDate=new Date(document.getElementById("fh-checkin").value);
                const eligible=flightDate <= hotelDate;
                showLoading(()=>{ addMessage(eligible?"âœ… Flight-Hotel Guarantee eligible based on dates":"âŒ Flight-Hotel Guarantee not applicable (hotel check-in not affected)"); });
              };
            } else addMessage("Please process as normal cancellation.");
          });
        } else addMessage("Please process as normal cancellation.");
      });
    } else addMessage("Please process as normal cancellation.");
  });
}

// Special Circumstance workflow including death and mental health
function startSpecialCircumstance(){
  addMessage("Select reason:");
  showButtons(["Not suitable for travel","Be hospitalized","Fracture","Pregnancy","Mental health","Death"],reason=>{
    currentScenario=reason;
    if(reason==="Death"){
      addMessage("No proof is needed. Remark: 'canceled due to death'. Please indicate the relationship to the deceased.");
    } else if(reason==="Mental health"){
      addMessage("Is there a cancellation ticket in processing?");
      showButtons(["Yes","No"],ans=>{
        if(ans==="Yes") addMessage("Please expedite and remark: 'Guest requests cancellation due to mental health issues, please escalate'.");
        else addMessage("Create Other>Other event and escalate to CS");
      });
    } else startSpecialCircumstanceProof();
  });
}

function startSpecialCircumstanceProof(){
  addMessage("Please select proof(s) the guest has provided:");
  const bubble=document.createElement("div");
  bubble.className="bubble bot";
  ["Official diagnostics","Medical leave certificate","Proof of medical charge","Proof of relationship"].forEach(proof=>{
    const cbDiv=document.createElement("div");
    cbDiv.className="checkbox-container";
    const cb=document.createElement("input");
    cb.type="checkbox"; cb.value=proof;
    const label=document.createElement("label"); label.textContent=proof;
    cbDiv.appendChild(cb); cbDiv.appendChild(label); bubble.appendChild(cbDiv);
  });
  const btn=document.createElement("button"); btn.textContent="Submit Proof Selection";
  btn.onclick=()=>{
    const checkboxes=bubble.querySelectorAll("input");
    providedProofs=[];
    checkboxes.forEach(cb=>{ if(cb.checked) providedProofs.push(cb.value); });
    parseProofSelection();
  };
  bubble.appendChild(btn);
  chatBox.appendChild(bubble);
  chatBox.scrollTop=chatBox.scrollHeight;
}

// Initialize
restartChat();

</script>
</body>
</html>